<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Modo Avanzado - CQL Teacher</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script src="codemirror/lib/codemirror.js" type="text/javascript"></script>
        <script src="codemirror/mode/sql/sql.js" type="text/javascript"></script>
        <script src="codemirror/mode/clike/clike.js" type="text/javascript"></script>
        <script src="codemirror/addon/edit/closebrackets.js" type="text/javascript"></script>
        <script src="jstree/dist/jstree.min.js"></script>
        <script src="grammar/LUPGrammar.js"></script>
        <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="http://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css" rel="stylesheet" type="text/css">
        <link href="codemirror/lib/codemirror.css" type="text/css" rel="stylesheet">
        <link href="codemirror/theme/monokai.css" type="text/css" rel="stylesheet">
        <link href="stylesheets/tabs.css" type="text/css" rel="stylesheet">
        <link href="jstree/dist/themes/default/style.min.css" rel="stylesheet" />
        <style media="screen">
            .row.display-flex {
                display: flex;
                flex-wrap: wrap;
            }
            .row.display-flex > [class*='col-'] {
                display: flex;
                flex-direction: column;
            }
            .CodeMirror {
                font-family: Consolas, monospace;
                font-size: 14px;
            }
            .alert-blacker {
                background-image: none;
                background-color: black;
                color: white;
            }
            .breakpoint {
                background-color: #ff77df;
            }
            .scroller {
                max-height:300px;
            }
            .tab-content {
                height: 400px;
            }
            #consola-de-salida {
                background-color: #000;
                border: 1px solid #000;
                color: #00ff00;
                padding: 8px;
                font-family: courier new;
            }
            a {
                cursor:pointer;
            }
        </style>
    </head>
    <body>
        <div class="navbar navbar-default navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"><span>CQL - Teacher</span></a>
                </div>
                <div class="collapse navbar-collapse" id="navbar-ex-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#">Cerrar sesión</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="text-center">MODO AVANZADO</h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="container">
                <div class="row display-flex">
                    <div class="col-md-3">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Árbol de trabajo</h3>
                            </div>
                            <div class="panel-body">
                                <div id="jstree_demo_div"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="col-md-12">
                            <div class="panel panel-primary">
                                <div class="panel-heading clearfix">
                                    <h4 class="panel-title pull-left" style="padding-top: 7.5px;">Editor de texto</h4>
                                    <div class="btn-group pull-right">
                                        <a id="btn-crear-tab"><i class="-open fa fa-2x fa-fw fa-plus text-danger"></i></a>
                                        <a href="#"><i class="fa fa-2x fa-folder-open fa-fw text-info"></i></a>
                                        <a href="#"><i class="-open fa fa-2x fa-fw fa-save text-inverse"></i></a>
                                        <a href="#"><i class="fa fa-2x fa-fw fa-play text-success"></i></a>
                                        <a href="#"><i class="fa fa-2x fa-bolt fa-fw text-warning"></i></a>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div id="tab-holder">
                                        <ul id="ul-tab" class="tabs">
                                            <li><a href="#NewTab">NewTab</a></li>
                                        </ul>
                                        <div id="div-tab" class="tabContainer">
                                            <div id="NewTab" class="tabContent">
                                                <textarea id="Area_1" class="editor" rows="5"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Consola de salida</h3>
                                </div>
                                <div class="panel-body">
                                    <textarea class="form-control" rows="10" id="consola-de-salida" disabled>>> que rollo bandera
                                    </textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AREA DE SCRIPTS -->
        <script type="text/javascript">

            $(document).ready(function(){

                $(function () { $('#jstree_demo_div').jstree(); });

                $('#jstree_demo_div').on("changed.jstree", function (e, data) {
                    console.log(data.selected);
                });

                $('#jstree_demo_div').jstree({ 'core' : {
                    'data' : [
                        'Simple root node',
                        {
                            'text' : 'Root node 2',
                            'state' : {
                                'opened' : true,
                                'selected' : true
                            },
                            'children' : [
                                { 'text' : 'Child 1' },
                                'Child 2'
                            ]
                        }
                    ]
                } });

            });

        </script>

        <script type="text/javascript">

            // Variable donde almacenare las instancias de textarea que genera CodeMirror para poder acceder al texto después.
            let codeblocks = [];

            $(document).ready(function(){
                //hiding tab content except first one
                $(".tabContent").not(":first").hide();
                // adding Active class to first selected tab and show
                $("ul.tabs li:first").addClass("active").show();
                // set editor
                setCodeEditorArea(document.getElementById('Area_1'), 'NewTab');
            });

            function getRandomNumber() {
                return Math.floor(Math.random() * 100);
            }

            function setCodeEditorArea(element, idTab) {

                let editor_holder = CodeMirror.fromTextArea(element, {
                    mode: "text/x-sql",
                    lineNumbers: true,
                    styleActiveLine: true,
                    matchBrackets: true,
                    indentUnit: 4,
                    indentWithTabs: true,
                    autoCloseBrackets: true
                });

                editor_holder.setSize(1140, 400);

                codeblocks.push({
                    id: idTab,
                    instancia: editor_holder
                });

            }



        </script>

        <script type="text/javascript">

            $(document).ready(function(){

                $('#btn-crear-tab').on('click', function(){

                    let id = 'NewTab' + getRandomNumber();
                    let idArea = 'Area' + getRandomNumber();

                    $('#ul-tab').append(
                        $('<li>').append(
                            $('<a>').attr('href', '#' + id).append(id)
                        )
                    );

                    $('#div-tab').append(
                        $('<div>').attr('id', id).attr('class', 'tabContent').attr('style', 'display:none;').append(
                            $('<textarea>').attr('id', idArea).attr('class', 'editor').attr('rows', 5)
                        )
                    );

                    // Click event on tab
                    $("ul.tabs li").click(function() {

                        // Removing class of Active tab
                        $("ul.tabs li.active").removeClass("active");
                        $("ul.tabs li").removeClass("colorz");
                        // Adding Active class to Clicked tab
                        $(this).addClass("active");
                        $("ul.tabs li").not( $(this) ).addClass("colorz");
                        // hiding all the tab contents
                        $(".tabContent").hide();
                        // showing the clicked tab's content using fading effect
                        $($('a',this).attr("href")).show();

                        return false;

                    });

                    setCodeEditorArea(document.getElementById(idArea), id);

                });

            });

        </script>

    </body>
</html>